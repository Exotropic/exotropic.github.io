<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EXOTROPIC AQUARIUM ADMIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f0f8ff; }
h1 { text-align: center; color: #001f2f; margin-bottom: 20px; }
input[type="text"], input[type="password"], input[type="file"] {
  width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #001f2f;
}
button { padding: 8px 12px; background: #001f2f; color: #a8edea; border: none; border-radius: 5px; cursor: pointer; margin-top: 5px; }
button:hover { background: #003f5c; }
.preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
.preview-item { position: relative; }
.preview-item img { width: 150px; border-radius: 10px; border: 2px solid #001f2f; }
.delete-btn {
  position: absolute; top: 5px; right: 5px; background: red; color: white;
  border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;
  font-weight: bold;
}
.floating-home {
  position: fixed; bottom: 20px; right: 20px;
  padding: 12px 18px; background: #001f2f; color: #a8edea;
  border-radius: 50px; text-decoration: none; font-weight: bold;
  transition: 0.3s;
}
.floating-home:hover { background: #003f5c; transform: scale(1.05); }
.show-hide { margin-top: 5px; cursor: pointer; color: #001f2f; font-size: 14px; display: inline-block; }
#adminSettings { display: none; }
#logoutBtn { display: none; margin-top: 10px; }
</style>
</head>
<body>

<h1>EXOTROPIC AQUARIUM ADMIN</h1>

<div id="loginForm">
  <label>Username</label>
  <input type="text" id="username" placeholder="Enter username">
  <label>Password</label>
  <input type="password" id="password" placeholder="Enter password">
  <span class="show-hide" id="togglePassword">Show Password</span>
  <button id="loginBtn">Login</button>
</div>

<div id="adminSettings">
  <label>Upload Images (Max 10 at a time)</label>
  <input type="file" id="imageInput" multiple accept="image/*">
  <button id="addBtn">Add to Website</button>

  <h2>Preview</h2>
  <div class="preview" id="previewContainer"></div>
</div>

<button id="logoutBtn">Logout</button>
<a href="index.html" class="floating-home" target="_blank">Go to Website</a>

<script>
// --- Admin Credentials ---
const USERNAME = "EXOTROPIC";
const PASSWORD = "CANADAEXOTROPIC";

// --- Cloudinary Settings ---
const CLOUD_NAME = "dgmg1cubi";
const UPLOAD_PRESET = "unsigned_products";      // images
const JSON_UPLOAD_PRESET = "unsigned_json";     // catalog JSON
const JSON_FILENAME = "products";               // public_id for JSON
const JSON_EXTENSION = "json";                  // file type

// --- Elements ---
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const togglePassword = document.getElementById("togglePassword");
const loginForm = document.getElementById("loginForm");
const adminSettings = document.getElementById("adminSettings");
const logoutBtn = document.getElementById("logoutBtn");
const imageInput = document.getElementById("imageInput");
const previewContainer = document.getElementById("previewContainer");
const addBtn = document.getElementById("addBtn");

// --- Store uploaded images ---
let uploadedImages = [];

// --- Show/Hide Password ---
togglePassword.addEventListener("click", () => {
  passwordInput.type = passwordInput.type === "password" ? "text" : "password";
  togglePassword.textContent = passwordInput.type === "password" ? "Show Password" : "Hide Password";
});

// --- Login ---
function showAdmin() {
  loginForm.style.display = "none";
  adminSettings.style.display = "block";
  logoutBtn.style.display = "inline-block";
  loadCatalog();
}

loginBtn.addEventListener("click", () => {
  if(usernameInput.value === USERNAME && passwordInput.value === PASSWORD){
    localStorage.setItem("isLoggedIn", "true");
    showAdmin();
  } else alert("Incorrect username or password!");
});

if(localStorage.getItem("isLoggedIn") === "true") showAdmin();

logoutBtn.addEventListener("click", () => {
  localStorage.removeItem("isLoggedIn");
  location.reload();
});

// --- Load catalog JSON from Cloudinary ---
async function loadCatalog() {
  try {
    const url = `https://res.cloudinary.com/${CLOUD_NAME}/raw/upload/${JSON_FILENAME}.${JSON_EXTENSION}?t=${Date.now()}`;
    const res = await fetch(url);
    if(res.ok){
      const data = await res.json();
      uploadedImages = data;
    } else {
      uploadedImages = [];
    }
    updatePreview();
  } catch(err){
    console.warn("No existing catalog found. Starting fresh.");
    uploadedImages = [];
    updatePreview();
  }
}

// --- Update preview ---
function updatePreview() {
  previewContainer.innerHTML = "";
  uploadedImages.forEach((url, index) => {
    const div = document.createElement("div");
    div.className = "preview-item";
    div.innerHTML = `<img src="${url}" alt="Product">
                     <button class="delete-btn" data-index="${index}">&times;</button>`;
    previewContainer.appendChild(div);
  });

  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const idx = btn.getAttribute("data-index");
      uploadedImages.splice(idx, 1);
      updatePreview();
      uploadCatalogJSON();
    });
  });
}

// --- Upload images to Cloudinary ---
imageInput.addEventListener("change", async () => {
  const files = Array.from(imageInput.files);
  if(files.length > 10){ alert("Max 10 images"); imageInput.value = ""; return; }

  for(const file of files){
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    try {
      const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
        method: "POST", body: formData
      });
      const data = await res.json();
      uploadedImages.push(data.secure_url);
      updatePreview();
    } catch(err){ console.error("Upload error:", err); }
  }
  imageInput.value = "";
});

// --- Add to Website (upload catalog JSON) ---
addBtn.addEventListener("click", uploadCatalogJSON);

// --- Upload catalog JSON to Cloudinary ---
async function uploadCatalogJSON() {
  const blob = new Blob([JSON.stringify(uploadedImages, null, 2)], { type: "application/json" });
  const formData = new FormData();
  formData.append("file", blob, `${JSON_FILENAME}.${JSON_EXTENSION}`);
  formData.append("upload_preset", JSON_UPLOAD_PRESET);
  formData.append("public_id", JSON_FILENAME); // same public_id to overwrite
  formData.append("overwrite", "true");        // important!

  try {
    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
      method: "POST", body: formData
    });
    const data = await res.json();
    console.log("Catalog JSON updated:", data.secure_url);
    alert("Catalog updated successfully!");
  } catch(err){ console.error("Failed to upload catalog JSON:", err); }
}
</script>
</body>
</html>
